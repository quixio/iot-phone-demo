# Global Agent Configuration
[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "1s"
  flush_jitter = "0s"
  precision = ""
  debug = false
  quiet = false
  logfile = ""

# Input Plugin: HTTP Listener v2
[[inputs.http_listener_v2]]
  service_address = ":80"
  path = "/telegraf"
  methods = ["POST"]
  data_format = "json_v2" 
  

  # Define the structure of the JSON to treat "payload" as a nested field
  [[inputs.http_listener_v2.json_v2]]
    measurement_name = "sensor_data"  # Custom name for the measurement
    [[inputs.http_listener_v2.json_v2.object]]
      path = "payload"  # Parse the whole payload as one field
      tag_keys = ["messageId", "sessionId", "deviceId"]  # Keep these as tags for filtering
      included_keys = ["name", "time", "values"]  # Retain fields as part of payload



# Output Plugin: Kafka
[[outputs.kafka]]
  brokers = [
    "kafka-k1.quix.io:9093",
    "kafka-k2.quix.io:9093",
    "kafka-k3.quix.io:9093"
  ]
  topic = "${Quix__Workspace__Id}-${OUTPUT_TOPIC}"
  data_format = "json"

  # SASL Authentication Settings

  sasl_username = "${KAFKA_SASL_USERNAME}"
  sasl_password = "${KAFKA_SASL_PASSWORD}"
  sasl_mechanism = "${KAFKA_SASL_MECHANISM}"

  # Security Protocol
  #security_protocol = "SASL_SSL"

  ## Optional TLS Config
  enable_tls = true
  tls_ca = "/etc/ssl/certs/ca.pem" 
  insecure_skip_verify = false